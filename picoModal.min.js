/*!
 * Original idea: https://github.com/Nycto/PicoModal
 * Accessibility inspiration: https://github.com/nico3333fr/jquery-accessible-modal-window-aria
 * MIT License (https://github.com/Aymkdn/picoModal-Accessible/blob/master/LICENSE)
*/
!function(e,t){"undefined"!=typeof module?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):this[e]=t()}("picoModal",function(){var e=function(e,t){"use strict";var n=function(){var t=[];return{watch:function(e){t.push(e)},trigger:function(){for(var n=0;n<t.length;n++)e.setTimeout(t[n],1)}}},i=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},o=function(e,n){1==arguments.length&&"string"==typeof e&&(n=e,e=null),n=n||"div";var r=t.createElement(n);(e||t.body).appendChild(r);var l={elem:r,child:function(e){return o(r,e||"a")},stylize:function(e){e=e||{},"undefined"!=typeof e.opacity&&(e.filter="alpha(opacity="+100*e.opacity+")");for(var t in e)e.hasOwnProperty(t)&&(r.style[t]=e[t]);return l},clazz:function(e){return r.className+=e,l},setAttr:function(e){for(var t in e)e.hasOwnProperty(t)&&r.setAttribute(t,e[t]);return l},invisible:function(){return this.stylize({border:"0 none",clip:"rect(0px, 0px, 0px, 0px)",height:"1px",margin:"-1px",overflow:"hidden",padding:"0",position:"absolute",width:"1px"}),l},html:function(e){return r.innerHTML=e,l},getWidth:function(){return r.clientWidth},onClick:function(e){return i(r,"click",e),l},destroy:function(){return t.body.removeChild(r),l}};return l},r=function(e){var t=n(),i=o().setAttr({title:"Close this windows"}).clazz("pico-overlay").stylize({display:"block",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick(t.trigger);return e("overlayClose",!0)&&i.child("span").invisible().setAttr({tabindex:"0",id:"overlayCloseForReaders"}).html(e("closeHtml","Close")),{elem:i.elem,destroy:i.destroy,onClick:t.watch}},l=function(e,t){var n=t.length?t[0]:t,i=n.parentNode,o=n.nextSibling;for(e.appendChild(n);t.length;)e.appendChild(t[0]);if(o)try{i.insertBefore(e,o)}catch(r){}else try{i.appendChild(e)}catch(r){}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or undefined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=o)return-1;for(n=Math.max(r>=0?r:o-Math.abs(r),0);o>n;){if(n in i&&i[n]===e)return n;n++}return-1});var a=function(e,t){if(e){var n,i,o=e.children,r=o.length;if(r>0){do a(o[r],t);while(r--)}else{switch(n=e.getAttribute("tabindex"),i=e.getAttribute("contenteditable"),e.tagName){case"A":case"AREA":case"INPUT":case"SELECT":case"TEXTAREA":case"BUTTON":if(!e.getAttribute("disabled"))return void t.push(e);break;case"IFRAME":case"OBJECT":case"EMBED":return void t.push(e)}if(null!==i)return void t.push(e);if(null!==n&&n>=0)return void t.push(e)}}};return function(e){function c(t,n){return void 0===e[t]?n:e[t]}"string"==typeof e&&(e={content:e});var d=t.activeElement;!function(){var e=(t.createDocumentFragment(),t.createElement("div"));e.setAttribute("aria-hidden","true"),e.setAttribute("id","picoModalProtect"),l(e,t.body.children),t.body.appendChild(e)}();var s,u=n(),f=o("dialog").clazz("pico-content").stylize({display:"block",position:"fixed",zIndex:10001,left:"50%",top:"50px"}).setAttr({role:"dialog"}).html(e.content),p=function(){y.destroy(),f.destroy();var e=t.body,n=t.getElementById("picoModalProtect");l(e,n.children),n.parentNode.removeChild(n),t.body.removeEventListener?t.body.removeEventListener("keydown",b,!1):t.body.detachEvent("onkeydown",b),d&&d.focus(),u.trigger()};c("closeButton",!0)&&(s=f.html("").child("button").html(c("closeHtml","Close")).clazz("pico-close").stylize(c("closeStyles",{borderRadius:"2px",cursor:"pointer",height:"auto",width:"auto",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).setAttr({tabindex:"0"}).onClick(p),s.elem.insertAdjacentHTML("afterend",e.content));var h=c("width",f.getWidth());f.stylize({width:h+"px",margin:"0 0 0 "+(-(h/2)+"px")}).stylize(c("modalStyles",{backgroundColor:"white",padding:"20px",borderRadius:"5px"}));var y=r(c);c("overlayClose",!0)&&y.onClick(p);var v;e.focusOn?(v=t.querySelector(c("focusOn")),v&&(v.setAttribute("tabindex","0"),setTimeout(function(){v.focus()},0))):c("closeButton",!0)?(v=s,s.elem.focus()):!function(){v=f.html("").child("span").setAttr({lang:"en",tabindex:"0"}).html("popup"),f.child("div").html(e.content),v.elem.focus(),setTimeout(function(){v.invisible()},250)}();var m=c("closeButton",!0)||c("overlayClose",!0),b=function(e){var n=e.which?e.which:e.keyCode;if(9==n){var i,o,r=[];a(f.elem,r),r.reverse(),i=r.length,o=r.indexOf(t.activeElement),0===o&&e.shiftKey?(r[i-1].focus(),e.preventDefault?e.preventDefault():e.returnValue=!1):o!==i-1||e.shiftKey||(r[0].focus(),e.preventDefault?e.preventDefault():e.returnValue=!1)}else 27==n&&m&&p()};return i(t.body,"keydown",b),{modalElem:f.elem,closeElem:s?s.elem:null,overlayElem:y.elem,close:p,onClose:u.watch}}}(window,document);return e});
